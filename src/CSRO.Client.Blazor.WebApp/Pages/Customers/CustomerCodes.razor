@page "/Customers/CustomerCodes"
@inherits CustomerCodesBase


<MudContainer>
    <div>
        <MudText Typo="Typo.h5" Class="mt-2" GutterBottom="true">Customer Search</MudText>
        @if (IsLoading)
        {
            <MudGrid>
                <MudItem>
                    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
                </MudItem>
                <MudItem>
                    <MudText Align="Align.Center">@LoadingMessage</MudText>
                </MudItem>
            </MudGrid>
        }

    <MudCard>
        <MudGrid>
            <MudItem xs="6" sm="3" Class="d-flex align-center justify-center mud-width-full py-8">                
                <MudCardContent>
                    <MudAutocomplete ResetValueOnEmptyText="true"
                                        T="@IdNameSdk"
                                        Label="All Subscriptions"
                                        ValueChanged="(e) => OnSubscriptionValueChanged(e)"
                                        For="@(() => Model.SubscripionIdName)"
                                        SearchFunc="@SearchSubs" />

                </MudCardContent>                
            </MudItem>

            <MudItem xs="6" sm="3" Class="d-flex align-center justify-center mud-width-full py-8">                
                    <MudItem xs="12" md="12">
                        <MudSelect T="@IdNameSdk"                                   
                                   HelperText="Pick your filtered Subscription"
                                   MultiSelection="true"   
                                   OffsetY="@IsFilterAutofocused"
                                   @bind-SelectedValues="SelectedSubs">
                            @foreach (var sub in SubscripionsFiltered)
                            {
                                <MudSelectItem T="IdNameSdk" Value="@sub">@sub</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>                
            </MudItem>
            
            <MudItem xs="6" sm="3" Class="d-flex align-center justify-center mud-width-full py-8">                
                    col 3                
            </MudItem>

            <MudItem xs="6" sm="3">
                <MudText Typo="Typo.body2">MudSelect.SelectedValues:</MudText>
                <MudText Typo="Typo.body2">{ @(string.Join(", ", SelectedSubs.Select(x=>$"\"{x}\""))) }</MudText>
                <MudButton Class="mt-4" OnClick="Search" Variant="Variant.Filled" Color="Color.Primary">Search</MudButton>
            </MudItem>
        </MudGrid>
    </MudCard>

    <MudCard>
        <MudTable Items="@Customers" Hover="true" Breakpoint="Breakpoint.Sm">
            <ColGroup>
                <col style="width:200px;" />
                <col style="width:100px;" />
                <col />
                <col style="width:100px;" />
            </ColGroup>
            <HeaderContent>
                <MudTh></MudTh>
                <MudTh>Nr</MudTh>
                <MudTh>Name</MudTh>
                <MudTh>Age</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd><MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => ShowBtnPress(context.SubscriptionId))">@((context.ShowDetails == true)? "Hide" : "Show") Address Details</MudButton></MudTd>
                <MudTd DataLabel="Subscription Id">@context.SubscriptionId</MudTd>
                <MudTd DataLabel="Name">@context.SubscriptionName</MudTd>
                @*<MudTd DataLabel="BillingReference Count">@context.DefaultTags.BillingReferenceList.Count</MudTd>
                <MudTd DataLabel="CmdbRerence Count">@context.DefaultTags.CmdbRerenceList.Count</MudTd>
                <MudTd DataLabel="OpEnvironment Count">@context.DefaultTags.OpEnvironmentList.Count</MudTd>*@
            </RowTemplate>
            <ChildRowContent>
                @if (context.ShowDetails)
                {
                    <MudTr>
                        <td colspan="4">
                            <MudCard Elevation="0">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.body1">Details for <strong>@context.SubscriptionName</strong></MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent Class="pa-0">
                                    <MudTable Items="@context.DefaultTags" 
                                              Context="DefaultTagsContext" Hover="true" 
                                              Breakpoint="Breakpoint.Sm" Elevation="0">
                                        <ColGroup>
                                            <col />
                                            <col />
                                            <col />
                                        </ColGroup>
                                        <HeaderContent>
                                            <MudTh>billingReference</MudTh>
                                            <MudTh>cmdbReference</MudTh>
                                            <MudTh>opEnvironment</MudTh>
                                        </HeaderContent>
                                        <RowTemplate>
                                            <MudTd DataLabel="billingReference">@DefaultTagsContext.billingReference</MudTd>
                                            <MudTd DataLabel="cmdbReference">@DefaultTagsContext.cmdbReference</MudTd>
                                            <MudTd DataLabel="opEnvironment">@DefaultTagsContext.opEnvironment</MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudCardContent>
                            </MudCard>
                        </td>
                    </MudTr>}
            </ChildRowContent>
        </MudTable>

    </MudCard>
    </div>
</MudContainer>
